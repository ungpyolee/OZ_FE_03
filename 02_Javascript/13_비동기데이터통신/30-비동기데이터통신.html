<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데이터 통신</title>
</head>

<body>
    <button id="push">PUSH</button>
    <hr>
    <img src="" alt="강아지 사진">
    <script>
        // https://dog.ceo/api/breeds/image/random

        const rqs = new XMLHttpRequest()
        const button = document.getElementById('push')

        button.addEventListener('click', function () {
            rqs.open("get", "https://dog.ceo/api/breeds/image/random")
            rqs.addEventListener('load', function () {
                const result = JSON.parse(rqs.response)
                const img = document.querySelector('img');
                img.src = result.message
            })
            rqs.send()
        })


    </script>
</body>

</html>

<!-- 
    HTTP(HyperText Transfer Protocol) 
    -웹 브라우저와 웹 서버가 데이터를 주고받을 수 있게 디자인된 통신규약
    -HTTP는 웹에서 이루어지는 모든 데이터 교환의 기초이며, 
    이 규약을 암호화하여 보안을 확보한 규약은 HTTPS라고한다.

    HTTP 통신

    클라이언트 ->   서버
     (사용자)  <- (호스트)

    HTTP 요청과 응답

    요청 행 : 요청 메소드, URL, HTTP버전 정보 등을 포함
    요청 헤더 : 메시지 정보, 메시지에 저장한 데이터 등을 포함
    메시지 본문 : 서버 측으로 보내는 데이터를 포함
    => 요청 메소드 GET, POST 등 데이터 송수신 방식

    응답 행 : 상태 코드, 보충 메시지, HTTP 버전 정보 등을 포함 
    응답 헤더 : 메시지 정보, 메시지에 저장한 데이터 정보 등을 포함
    메시지 본문 : 클라이언트 측으로 보내는 데이터를 포함
    => 상태 코드는 요청이 성공적으로 완료되었는지를 보여주는 숫자 코드

    200 - OK - 요청 성공

    400번대 오류 코드는 대부분 요청자의 문제
    401 - unauthorized - 인증 실패
    403 - Forbidden - 액세스 허용되지 않음
    404 - Not Found - 요청한 리소스를 찾지 못함

    500번대 오류 코드는 대체로 서버쪽(데이터 제공자)의 문제
    500 - Internet Server Error - 서버 내부 오류 발생
    503 - Server Unanailable - 서비스를 일시적 사용 불가

    XMLHttpRequest
    - 서버와 상호작용하기 위해 사용하는 자바스크립트 빌트인 생성자
    - 이를 사용하면 서버(URL)로 부터 데이터를 받아와 전체 페이지의 새로고침 없이도 
    페이지의 일부만 업데이트하는 비동기 방식의 데이터 통신을 수행할 수 있다.
    - 이러한 프로그래밍 기법을 Ajax(Asynchronous Javascript And XML)이라고 한다.
    - Ajax는 웹 서버와 비동기로 통신하고 DOM을 이용하여 웹 페이지를 동적으로 갱신하는 기법

    Ajax 기법에 기초한 XMLHttpRequest 비동기 통신의 세 단계

    1. XMLHTTPRequest 객체를 생성한다
    2. 서버와 통신할 때 필요한 정보 및 처리 방법(load) 들을 기입한다.
    3. 요청을 전송해 통신을 시작한다

    -> 객체 생성은 new 연산

    비동기 통신을 할 때는 서버와의 통신 상태를 감시할 수 있다.
    
    abort - 요청이 취소되었을 때
    error - 요청이 실패했을 때
    load - 요청을 성공하여 응답을 가져올 수 있을 때 ***
    progress - 데이터를 주고받는 중
    time out - 요청시간을 초과했을 때
 -->